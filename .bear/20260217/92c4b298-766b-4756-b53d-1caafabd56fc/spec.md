# 사용자 요구사항 입력 프롬프트 명세

## 1. 개요

Bear AI Developer 애플리케이션의 핵심 실행 플로우 3단계인 **"사용자 요구사항 입력"** 기능을 추가한다. 워크스페이스 경로 설정(2단계)이 완료된 직후, 사용자에게 요구사항을 입력받는 TUI 프롬프트를 표시한다. 이 프롬프트는 기존 워크스페이스 프롬프트(`ui/workspace_prompt.go`)와 동일한 입력 컴포넌트(textarea)를 기반으로 하되, 별도의 독립적인 Bubble Tea 모델로 구현한다.

## 2. 목표 및 비목표

### 목표 (In-scope)

- 워크스페이스 설정 완료 후 요구사항 입력 프롬프트를 표시한다.
- 사용자가 자유 형식의 텍스트로 요구사항을 입력할 수 있도록 한다.
- 텍스트 길이 제한 없이 입력을 받는다 (터미널/OS 한계 내에서).
- 터미널 가로 폭을 초과하는 텍스트는 자동으로 wrap하여 표시한다.
- 붙여넣기된 텍스트도 직접 타이핑한 텍스트와 동일하게 처리한다.
- Shift+Enter 또는 Alt+Enter로 줄바꿈을 삽입할 수 있도록 한다.
- 방향키로 커서 이동을 지원한다.
- Enter로 입력을 확정하고 프로그램을 정상 종료한다.
- Ctrl+G로 외부 에디터를 열어 입력할 수 있도록 한다.
- Ctrl+C로 입력을 취소하고 프로그램을 종료한다.

### 비목표 (Out-of-scope)

- 다음 단계(스펙 에이전트 호출, 명확화 질문 등)의 구현은 이번 작업에 포함하지 않는다.
- 요구사항 입력 완료 후 입력된 텍스트를 후속 처리하는 로직은 구현하지 않는다.
- 입력 이력 관리, 자동 저장, 자동 완성 등의 부가 기능은 포함하지 않는다.
- 기존 워크스페이스 프롬프트(`WorkspacePromptModel`)의 동작 변경은 포함하지 않는다.

## 3. 기능 요구사항

### FR-1: 프롬프트 표시 시점

- 워크스페이스 경로 설정이 성공적으로 완료된 직후(사용자가 취소하지 않은 경우), 요구사항 입력 프롬프트가 표시되어야 한다.
- 워크스페이스 프롬프트에서 사용자가 Ctrl+C로 취소한 경우, 요구사항 프롬프트는 표시되지 않고 프로그램이 종료되어야 한다.

### FR-2: 프롬프트 UI 구성

- 요구사항 입력 프롬프트는 기존 워크스페이스 프롬프트와 동일한 textarea 기반 입력 컴포넌트를 사용한다.
- 프롬프트에는 사용자에게 요구사항 입력을 안내하는 레이블 텍스트가 표시되어야 한다.
- 프롬프트에는 사용 가능한 키 조합(Enter로 확정, Shift+Enter/Alt+Enter로 줄바꿈, Ctrl+G로 외부 에디터)을 안내하는 도움말 텍스트가 표시되어야 한다.

### FR-3: 텍스트 입력

- 입력 텍스트의 길이에 제한이 없어야 한다 (글자 수 제한 0, 즉 무제한).
- 입력된 텍스트는 화면에 사용자가 입력한 그대로 표시되어야 한다.
- 터미널 가로 폭을 초과하는 텍스트는 오른쪽이 잘리지 않고 자동으로 wrap되어 다음 줄에 이어서 표시되어야 한다.
- 붙여넣기된 텍스트도 직접 타이핑한 텍스트와 동일하게 처리되어야 한다.
- textarea의 높이는 입력된 텍스트의 줄 수에 따라 동적으로 조정되어야 한다.

### FR-4: 키 바인딩

| 키 입력 | 동작 |
|---------|------|
| Enter | 입력 확정 (FR-5 참조) |
| Shift+Enter | 줄바꿈 삽입 |
| Alt+Enter | 줄바꿈 삽입 |
| Ctrl+G | 외부 에디터 열기 (FR-6 참조) |
| Ctrl+C | 입력 취소 및 프로그램 종료 |
| 방향키 (↑↓←→) | 커서 이동 |

### FR-5: 입력 확정 (Enter)

- 사용자가 Enter를 누르면 입력된 텍스트를 확정한다.
- 입력된 텍스트가 빈 문자열이거나 공백 문자만 포함하는 경우:
  - 에러 메시지를 표시한다.
  - 프롬프트는 입력 대기 상태를 유지한다.
  - 사용자는 계속 입력할 수 있다.
- 입력된 텍스트가 유효한(비어있지 않은) 경우:
  - 입력을 확정하고 프로그램을 정상 종료한다.
  - 이번 작업 범위에서는 입력된 텍스트에 대한 후속 처리 없이 단순 종료한다.

### FR-6: 외부 에디터 연동 (Ctrl+G)

#### FR-6-1: 에디터 선택 우선순위

다음 우선순위에 따라 사용할 에디터를 결정한다:

1. `EDITOR` 환경변수가 설정되어 있으면, 해당 값을 에디터 명령으로 사용한다.
2. `EDITOR` 환경변수가 설정되어 있지 않은 경우:
   1. 시스템에 `code` 명령이 존재하면, `code --wait` 옵션과 함께 VSCode를 사용한다.
   2. `code` 명령이 없고 `vi` 명령이 존재하면, `vi`를 사용한다.
   3. `code`와 `vi` 명령이 모두 없으면, 영어로 에러 메시지를 표시하고 프롬프트로 돌아와서 입력을 계속할 수 있도록 한다.

#### FR-6-2: 임시 파일

- 외부 에디터를 열기 위해 임시 파일을 생성한다.
- 임시 파일의 확장자는 `.md`이다.
- 에디터를 열기 전에 현재 textarea에 입력된 내용이 있으면, 해당 내용을 임시 파일에 미리 채워넣는다.
- 에디터 종료 후 임시 파일은 정리(삭제)되어야 한다.

#### FR-6-3: 에디터 실행 흐름

1. 사용자가 Ctrl+G를 입력한다.
2. 현재 textarea의 내용을 임시 파일(`.md`)에 기록한다.
3. FR-6-1의 우선순위에 따라 에디터를 결정한다.
4. 사용 가능한 에디터가 없으면 영어 에러 메시지를 표시하고 프롬프트로 복귀한다.
5. TUI 프로그램을 일시 중단하고 외부 에디터를 실행한다.
6. 사용자가 에디터에서 내용을 편집하고 저장 후 에디터를 닫는다.
7. 임시 파일의 내용을 읽어 textarea에 반영한다.
8. TUI 프로그램을 재개하고, 에디터에서 작성한 내용이 프롬프트에 표시된다.
9. 임시 파일을 삭제한다.

#### FR-6-4: 에디터 에러 처리

- 에디터 실행 중 에러가 발생하면 (에디터 프로세스 실패 등), 에러 메시지를 표시하고 프롬프트로 복귀한다.
- 에디터가 에러를 반환하더라도 프로그램이 비정상 종료되어서는 안 된다.

### FR-7: 입력 취소 (Ctrl+C)

- 사용자가 Ctrl+C를 누르면 프로그램을 종료한다.
- 워크스페이스 프롬프트의 Ctrl+C 동작과 동일한 방식으로 종료한다.

### FR-8: 독립적 모델

- 요구사항 입력 프롬프트는 기존 `WorkspacePromptModel`과 별도의 독립적인 Bubble Tea 모델로 구현한다.
- `app/app.go`의 `Run()` 함수에서 워크스페이스 프롬프트 완료 후 순차적으로 요구사항 프롬프트를 실행한다.
- 요구사항 프롬프트 모델은 실행 결과를 반환할 수 있는 Result 메서드를 제공해야 한다. 결과에는 최소한 다음 정보가 포함되어야 한다:
  - 입력된 요구사항 텍스트
  - 사용자가 취소했는지 여부

### FR-9: 터미널 반응형 레이아웃

- 터미널 크기 변경 시 textarea의 너비가 새로운 터미널 너비에 맞게 조정되어야 한다.
- 초기화 시 터미널 크기가 결정되기 전까지는 적절한 대기 상태 메시지를 표시한다.

## 4. 비기능 요구사항

### NFR-1: 기존 코드와의 일관성

- 새로 추가되는 코드는 기존 코드베이스의 코딩 컨벤션과 패턴을 따라야 한다 (Bubble Tea 모델 패턴, 스타일 변수 사용, 에러 처리 방식 등).

### NFR-2: 코드 구조

- 프로젝트의 CLAUDE.md에 명시된 코딩 규칙(함수 길이 제한, 단일 책임 원칙, 들여쓰기 중첩 제한 등)을 준수해야 한다.

### NFR-3: 성능

- 텍스트 입력 시 눈에 띄는 지연(lag)이 없어야 한다.
- 대량의 텍스트를 붙여넣기할 때도 정상적으로 처리되어야 한다.

## 5. 수용 기준

### AC-1: 프롬프트 표시

- 프로그램 실행 → 워크스페이스 경로 확정 → 요구사항 입력 프롬프트가 표시되는 전체 흐름이 정상적으로 동작한다.
- 요구사항 프롬프트에 안내 레이블과 키 조합 도움말이 표시된다.

### AC-2: 텍스트 입력 및 표시

- 자유 형식의 텍스트를 입력할 수 있고, 입력한 그대로 화면에 표시된다.
- 터미널 가로 폭을 초과하는 긴 텍스트가 자동으로 wrap되어 다음 줄에 표시된다.
- 붙여넣기된 텍스트가 직접 타이핑한 텍스트와 동일하게 표시된다.

### AC-3: 줄바꿈 삽입

- Shift+Enter를 입력하면 현재 커서 위치에 줄바꿈이 삽입되고 textarea 높이가 자동으로 조정된다.
- Alt+Enter를 입력하면 동일하게 줄바꿈이 삽입되고 textarea 높이가 자동으로 조정된다.

### AC-4: 커서 이동

- 방향키(↑↓←→)로 textarea 내에서 커서를 자유롭게 이동할 수 있다.

### AC-5: 입력 확정

- 비어있지 않은 텍스트를 입력한 후 Enter를 누르면 프로그램이 정상 종료된다.
- 빈 입력(공백만 포함) 상태에서 Enter를 누르면 에러 메시지가 표시되고, 프롬프트는 입력 대기 상태를 유지한다.
- 에러 메시지 표시 후 사용자가 텍스트를 입력하기 시작하면 에러 메시지가 사라진다.

### AC-6: 외부 에디터 (Ctrl+G)

- `EDITOR` 환경변수가 설정된 경우, Ctrl+G를 누르면 해당 에디터가 `.md` 임시 파일과 함께 열린다.
- `EDITOR` 미설정 시 `code` 명령이 있으면 `code --wait`로 열린다.
- `EDITOR` 미설정이고 `code`도 없으면 `vi`로 열린다.
- `EDITOR` 미설정이고 `code`, `vi` 모두 없으면 영어 에러 메시지가 표시되고 프롬프트로 복귀한다.
- 에디터를 열기 전에 textarea에 내용이 있으면 임시 파일에 해당 내용이 미리 채워진다.
- 에디터에서 편집 후 저장하고 닫으면, 편집된 내용이 textarea에 반영되어 표시된다.
- 에디터 종료 후 임시 파일이 삭제된다.

### AC-7: 입력 취소

- Ctrl+C를 누르면 프로그램이 종료된다.

### AC-8: 독립적 모델 구조

- 요구사항 프롬프트 모델은 `WorkspacePromptModel`과 별도의 독립적인 모델이다.
- `app/app.go`의 `Run()` 함수에서 워크스페이스 프롬프트 완료 후 요구사항 프롬프트가 순차적으로 실행된다.
- 요구사항 프롬프트 모델의 Result 메서드에서 입력된 텍스트와 취소 여부를 조회할 수 있다.

### AC-9: 터미널 반응형

- 프롬프트가 표시된 상태에서 터미널 크기를 변경하면 textarea의 너비가 새 크기에 맞게 조정된다.

## 6. 미결 사항 (Open Questions)

- 없음. 모든 요구사항이 명확화 Q&A를 통해 충분히 확인되었다.
